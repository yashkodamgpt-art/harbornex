import { log } from './utils/log.js';
/**
 * Spawn a process as a promise
 *
 * @param {string} name
 * @param {Array<string>} args
 * @param {SpawnOptions} [options]
 * @returns {Promise<SpawnPromiseResult>}
 */
export async function spawnPromise(name, args, options = {}) {
    const { spawn } = await import('node:child_process');
    const fork = spawn(name, args, options);
    log(`Spawning ${name} with ${args}`);
    let stdout = '';
    let stderr = '';
    return new Promise((resolve) => {
        // eslint-disable-next-line @typescript-eslint/no-explicit-any
        fork.stdout?.on('data', (data) => {
            log(`Spawn ${name} stdout: ${data}`);
            stdout += data;
        });
        // eslint-disable-next-line @typescript-eslint/no-explicit-any
        fork.stderr?.on('data', (data) => {
            log(`Spawn ${name} stderr: ${data}`);
            stderr += data;
        });
        fork.on('close', (code) => {
            log(`Spawn ${name}: Child process exited with code ${code}`);
            resolve({ stdout, stderr, code });
        });
    });
}
